{"pageProps":{"rule":{"metadata":{"creation_date":"2023/09/25","integration":["endpoint"],"maturity":"production","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0","updated_date":"2023/09/25","bypass_bbr_timing":true},"rule":{"author":["Elastic"],"description":"Identifies the execution of commonly abused Windows utilities via a delayed Ping execution. This behavior is often\nobserved during malware installation and is consistent with an attacker attempting to evade detection.\n","from":"now-9m","index":["logs-endpoint.events.*"],"language":"eql","license":"Elastic License v2","name":"Delayed Execution via Ping","risk_score":21,"rule_id":"e00b8d49-632f-4dc6-94a5-76153a481915","severity":"low","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Execution","Tactic: Defense Evasion","Data Source: Elastic Defend","Rule Type: BBR"],"type":"eql","building_block_type":"default","query":"sequence by process.parent.entity_id with maxspan=1m\n  [process where host.os.type == \"windows\" and event.action == \"start\" and process.name : \"ping.exe\" and\n   process.args : \"-n\" and process.parent.name : \"cmd.exe\" and not user.id : \"S-1-5-18\"]\n  [process where host.os.type == \"windows\" and event.action == \"start\" and\n   process.parent.name : \"cmd.exe\" and\n   (\n        process.name : (\n            \"rundll32.exe\", \"powershell.exe\",\n            \"mshta.exe\", \"msbuild.exe\",\n            \"certutil.exe\", \"regsvr32.exe\",\n            \"powershell.exe\", \"cscript.exe\",\n            \"wscript.exe\", \"wmic.exe\",\n            \"installutil.exe\", \"msxsl.exe\",\n            \"Microsoft.Workflow.Compiler.exe\",\n            \"ieexec.exe\", \"iexpress.exe\",\n            \"RegAsm.exe\", \"installutil.exe\",\n            \"RegSvcs.exe\", \"RegAsm.exe\"\n        ) or\n        (process.executable : \"?:\\\\Users\\\\*\\\\AppData\\\\*.exe\" and not process.code_signature.trusted == true)\n    ) and\n\n    not process.args : (\"?:\\\\Program Files\\\\*\", \"?:\\\\Program Files (x86)\\\\*\") and\n    not (process.name : (\"openssl.exe\", \"httpcfg.exe\", \"certutil.exe\") and process.parent.command_line : \"*ScreenConnectConfigurator.cmd*\") and\n    not (process.pe.original_file_name : \"DPInst.exe\" and process.command_line : \"driver\\\\DPInst_x64  /f \") and\n    not (process.name : \"powershell.exe\" and process.args : \"Write-Host ======*\") and\n    not (process.name : \"wscript.exe\" and process.args : \"launchquiet_args.vbs\" and process.parent.args : \"?:\\\\Windows\\\\TempInst\\\\7z*\") and\n    not (process.name : \"regsvr32.exe\" and process.args : (\"?:\\\\windows\\\\syswow64\\\\msxml?.dll\", \"msxml?.dll\", \"?:\\\\Windows\\\\SysWOW64\\\\mschrt20.ocx\")) and \n    not (process.name : \"wscript.exe\" and\n         process.working_directory :\n                    (\"?:\\\\Windows\\\\TempInst\\\\*\",\n                     \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\BackupBootstrapper\\\\Logs\\\\\",\n                     \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\QBTools\\\\\"))\n    ]\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"name":"Command and Scripting Interpreter","id":"T1059","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"name":"Visual Basic","id":"T1059.005","reference":"https://attack.mitre.org/techniques/T1059/005/"},{"name":"PowerShell","id":"T1059.001","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}],"tactic":{"name":"Execution","id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002/"}},{"framework":"MITRE ATT&CK","technique":[{"id":"T1497","name":"Virtualization/Sandbox Evasion","reference":"https://attack.mitre.org/techniques/T1497/","subtechnique":[{"name":"Time Based Evasion","id":"T1497.003","reference":"https://attack.mitre.org/techniques/T1497/003/"}]},{"name":"System Binary Proxy Execution","id":"T1218","reference":"https://attack.mitre.org/techniques/T1218/","subtechnique":[{"name":"CMSTP","id":"T1218.003","reference":"https://attack.mitre.org/techniques/T1218/003/"},{"name":"InstallUtil","id":"T1218.004","reference":"https://attack.mitre.org/techniques/T1218/004/"},{"name":"Mshta","id":"T1218.005","reference":"https://attack.mitre.org/techniques/T1218/005/"},{"name":"Regsvcs/Regasm","id":"T1218.009","reference":"https://attack.mitre.org/techniques/T1218/009/"},{"name":"Regsvr32","id":"T1218.010","reference":"https://attack.mitre.org/techniques/T1218/010/"},{"name":"Rundll32","id":"T1218.011","reference":"https://attack.mitre.org/techniques/T1218/011/"}]},{"name":"System Script Proxy Execution","id":"T1216","reference":"https://attack.mitre.org/techniques/T1216/"},{"name":"XSL Script Processing","id":"T1220","reference":"https://attack.mitre.org/techniques/T1220/"}],"tactic":{"name":"Defense Evasion","id":"TA0005","reference":"https://attack.mitre.org/tactics/TA0005/"}}]}}},"__N_SSG":true}