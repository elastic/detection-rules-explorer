{"pageProps":{"rule":{"metadata":{"creation_date":"2020/11/18","integration":["endpoint","windows"],"maturity":"production","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0","updated_date":"2023/06/22"},"rule":{"author":["Elastic"],"description":"Identifies execution from a directory masquerading as the Windows Program Files directories. These paths are trusted and\nusually host trusted third party programs. An adversary may leverage masquerading, along with low privileges to bypass\ndetections allowlisting those folders.\n","from":"now-9m","index":["winlogbeat-*","logs-endpoint.events.*","logs-windows.*","endgame-*"],"language":"eql","license":"Elastic License v2","name":"Program Files Directory Masquerading","note":"## Setup\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2, events will not define `event.ingested` and default fallback for EQL rules was not added until 8.2, so you will need to add a custom pipeline to populate `event.ingested` to @timestamp for this rule to work.\n","risk_score":47,"rule_id":"32c5cf9c-2ef8-4e87-819e-5ccb7cd18b14","severity":"medium","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Endgame","Data Source: Elastic Defend"],"timestamp_override":"event.ingested","type":"eql","query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n process.executable : \"C:\\\\*Program*Files*\\\\*.exe\" and\n not process.executable : (\"C:\\\\Program Files\\\\*.exe\", \"C:\\\\Program Files (x86)\\\\*.exe\", \"C:\\\\Users\\\\*.exe\", \"C:\\\\ProgramData\\\\*.exe\")\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.005","name":"Match Legitimate Name or Location","reference":"https://attack.mitre.org/techniques/T1036/005/"}]}],"tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"}}]}}},"__N_SSG":true}