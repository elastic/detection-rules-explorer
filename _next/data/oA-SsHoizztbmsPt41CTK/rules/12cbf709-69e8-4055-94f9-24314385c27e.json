{"pageProps":{"rule":{"metadata":{"creation_date":"2022/07/05","integration":["kubernetes"],"maturity":"production","updated_date":"2024/05/21"},"rule":{"author":["Elastic"],"description":"This rules detects an attempt to create or modify a pod attached to the host network. HostNetwork allows a pod to use\nthe node network namespace. Doing so gives the pod access to any service running on localhost of the host. An attacker\ncould use this access to snoop on network activity of other pods on the same node or bypass restrictive network policies\napplied to its given namespace.\n","false_positives":["    An administrator or developer may want to use a pod that runs as root and shares the hosts IPC, Network, and PID\n    namespaces for debugging purposes. If something is going wrong in the cluster and there is no easy way to SSH onto\n    the host nodes directly, a privileged pod of this nature can be useful for viewing things like iptable rules and\n    network namespaces from the host's perspective. Add exceptions for trusted container images using the query field\n    \"kubernetes.audit.requestObject.spec.container.image\"\n    "],"index":["logs-kubernetes.*"],"language":"kuery","license":"Elastic License v2","name":"Kubernetes Pod Created With HostNetwork","note":"## Setup\n\nThe Kubernetes Fleet integration with Audit Logs enabled or similarly structured data is required to be compatible with this rule.","references":["https://research.nccgroup.com/2021/11/10/detection-engineering-for-kubernetes-clusters/#part3-kubernetes-detections","https://kubernetes.io/docs/concepts/security/pod-security-policy/#host-namespaces","https://bishopfox.com/blog/kubernetes-pod-privilege-escalation"],"risk_score":47,"rule_id":"12cbf709-69e8-4055-94f9-24314385c27e","severity":"medium","tags":["Data Source: Kubernetes","Tactic: Execution","Tactic: Privilege Escalation","Language: kuery"],"timestamp_override":"event.ingested","type":"query","query":"event.dataset : \"kubernetes.audit_logs\"\n  and kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\"\n  and kubernetes.audit.objectRef.resource:\"pods\"\n  and kubernetes.audit.verb:(\"create\" or \"update\" or \"patch\")\n  and kubernetes.audit.requestObject.spec.hostNetwork:true\n  and not kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1611","name":"Escape to Host","reference":"https://attack.mitre.org/techniques/T1611/"}],"tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"}},{"framework":"MITRE ATT&CK","technique":[{"id":"T1610","name":"Deploy Container","reference":"https://attack.mitre.org/techniques/T1610/"}],"tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"}}]}}},"__N_SSG":true}