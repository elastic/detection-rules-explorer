{"pageProps":{"rule":{"metadata":{"creation_date":"2022/05/17","integration":["kubernetes"],"maturity":"production","updated_date":"2024/05/21"},"rule":{"author":["Elastic"],"description":"This rule detects a user attempt to establish a shell session into a pod using the 'exec' command. Using the 'exec'\ncommand in a pod allows a user to establish a temporary shell session and execute any process/commands in the pod. An\nadversary may call bash to gain a persistent interactive shell which will allow access to any data the pod has\npermissions to, including secrets.\n","false_positives":["    An administrator may need to exec into a pod for a legitimate reason like debugging purposes. Containers built from\n    Linux and Windows OS images, tend to include debugging utilities. In this case, an admin may choose to run commands\n    inside a specific container with kubectl exec ${POD_NAME} -c ${CONTAINER_NAME} -- ${CMD} ${ARG1} ${ARG2} ...\n    ${ARGN}. For example, the following command can be used to look at logs from a running Cassandra pod: kubectl exec\n    cassandra --cat /var/log/cassandra/system.log . Additionally, the -i and -t arguments might be used to run a shell\n    connected to the terminal: kubectl exec -i -t cassandra -- sh\n    "],"index":["logs-kubernetes.*"],"language":"kuery","license":"Elastic License v2","name":"Kubernetes User Exec into Pod","note":"## Setup\n\nThe Kubernetes Fleet integration with Audit Logs enabled or similarly structured data is required to be compatible with this rule.","references":["https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/","https://kubernetes.io/docs/tasks/debug/debug-application/get-shell-running-container/"],"risk_score":47,"rule_id":"14de811c-d60f-11ec-9fd7-f661ea17fbce","severity":"medium","tags":["Data Source: Kubernetes","Tactic: Execution"],"timestamp_override":"event.ingested","type":"query","query":"event.dataset : \"kubernetes.audit_logs\"\n  and kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\"\n  and kubernetes.audit.verb:\"create\"\n  and kubernetes.audit.objectRef.resource:\"pods\"\n  and kubernetes.audit.objectRef.subresource:\"exec\"\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1609","name":"Container Administration Command","reference":"https://attack.mitre.org/techniques/T1609/"}],"tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"}}]}}},"__N_SSG":true}