{"pageProps":{"rule":{"metadata":{"creation_date":"2020/12/04","integration":["endpoint","windows","system"],"maturity":"production","updated_date":"2024/08/07"},"rule":{"author":["Elastic"],"description":"An adversary can use Windows Management Instrumentation (WMI) to install event filters, providers, consumers, and\nbindings that execute code when a defined event occurs. Adversaries may use the capabilities of WMI to subscribe to an\nevent and execute arbitrary code when that event occurs, providing persistence on a system.\n","from":"now-9m","index":["logs-endpoint.events.process-*","winlogbeat-*","logs-windows.*","endgame-*","logs-system.security*"],"language":"eql","license":"Elastic License v2","name":"Persistence via WMI Event Subscription","references":["https://www.elastic.co/security-labs/hunting-for-persistence-using-elastic-security-part-1"],"risk_score":21,"rule_id":"9b6813a1-daf1-457e-b0e6-0bb4e55b8a4c","setup":"## Setup\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2,\nevents will not define `event.ingested` and default fallback for EQL rules was not added until version 8.2.\nHence for this rule to work effectively, users will need to add a custom ingest pipeline to populate\n`event.ingested` to @timestamp.\nFor more details on adding a custom ingest pipeline refer - https://www.elastic.co/guide/en/fleet/current/data-streams-pipeline-tutorial.html\n","severity":"low","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Persistence","Tactic: Execution","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: System"],"timestamp_override":"event.ingested","type":"eql","query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n  (process.name : \"wmic.exe\" or ?process.pe.original_file_name == \"wmic.exe\") and\n  process.args : \"create\" and\n  process.args : (\"ActiveScriptEventConsumer\", \"CommandLineEventConsumer\")\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1546","name":"Event Triggered Execution","reference":"https://attack.mitre.org/techniques/T1546/","subtechnique":[{"id":"T1546.003","name":"Windows Management Instrumentation Event Subscription","reference":"https://attack.mitre.org/techniques/T1546/003/"}]}],"tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"}},{"framework":"MITRE ATT&CK","technique":[{"id":"T1047","name":"Windows Management Instrumentation","reference":"https://attack.mitre.org/techniques/T1047/"}],"tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"}}]}}},"__N_SSG":true}