{"pageProps":{"rule":{"hunt":{"author":"Elastic","description":"This hunt looks for DNS queries performed by commonly abused Microsoft binaries that perform remote file transfer or binary proxy execution. Aggregations for the number of occurrences is limited to one host to reduce the number of potentially legitimate hits.\n","integration":["endpoint","windows"],"uuid":"1c7be6db-12eb-4281-878d-b6abe0454f36","name":"DNS Queries via LOLBins with Low Occurence Frequency","language":["ES|QL"],"license":"Elastic License v2","notes":["Utilities like curl and SSL verification for web services are noisy, while others are rare such as scripting utilities and are worth further investigation.","Connection to legit domains like Github, Discord, Telegram and many other legit web services by LOLBins is still suspicious and require further investigation."],"mitre":["T1071"],"query":["from logs-endpoint.events.network-*, logs-windows.sysmon_operational-*\n| where @timestamp > now() - 7 day and host.os.family == \"windows\" and event.category == \"network\" and\n  event.action in (\"lookup_requested\", \"DNSEvent (DNS query)\") and\n  process.name in (\"powershell.exe\", \"rundll32.exe\", \"certutil.exe\", \"curl.exe\", \"wget.exe\", \"CertReq.exe\", \"bitsadmin.exe\", \"mshta.exe\", \"pwsh.exe\", \"wmic.exe\", \"wscript.exe\", \"cscript.exe\", \"msbuild.exe\", \"regsvr32.exe\", \"MSBuild.exe\", \"InstallUtil.exe\", \"RegAsm.exe\", \"RegSvcs.exe\",  \"msxsl.exe\", \"CONTROL.EXE\", \"Microsoft.Workflow.Compiler.exe\", \"msiexec.exe\") and dns.question.name rlike \"\"\".+\\.[a-z-A-Z]{2,3}\"\"\"\n| keep process.name,  dns.question.name, host.id\n| stats occurrences = count(*), hosts = count_distinct(host.id) by process.name, dns.question.name\n| where hosts == 1\n"]},"rule":{"tags":["Hunt Type: Hunt"],"query":["from logs-endpoint.events.network-*, logs-windows.sysmon_operational-*\n| where @timestamp > now() - 7 day and host.os.family == \"windows\" and event.category == \"network\" and\n  event.action in (\"lookup_requested\", \"DNSEvent (DNS query)\") and\n  process.name in (\"powershell.exe\", \"rundll32.exe\", \"certutil.exe\", \"curl.exe\", \"wget.exe\", \"CertReq.exe\", \"bitsadmin.exe\", \"mshta.exe\", \"pwsh.exe\", \"wmic.exe\", \"wscript.exe\", \"cscript.exe\", \"msbuild.exe\", \"regsvr32.exe\", \"MSBuild.exe\", \"InstallUtil.exe\", \"RegAsm.exe\", \"RegSvcs.exe\",  \"msxsl.exe\", \"CONTROL.EXE\", \"Microsoft.Workflow.Compiler.exe\", \"msiexec.exe\") and dns.question.name rlike \"\"\".+\\.[a-z-A-Z]{2,3}\"\"\"\n| keep process.name,  dns.question.name, host.id\n| stats occurrences = count(*), hosts = count_distinct(host.id) by process.name, dns.question.name\n| where hosts == 1\n"],"license":"Elastic License v2","description":"This hunt looks for DNS queries performed by commonly abused Microsoft binaries that perform remote file transfer or binary proxy execution. Aggregations for the number of occurrences is limited to one host to reduce the number of potentially legitimate hits.\n","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"","name":"","reference":""},"technique":[{"id":"T1071","name":"","reference":"https://attack.mitre.org/techniques/T1071/"}]}]},"metadata":{"creation_date":"1970-01-01T00:00:00.000Z","updated_date":"1970-01-01T00:00:00.000Z","integration":["endpoint","windows"]}}},"__N_SSG":true}