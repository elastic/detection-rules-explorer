{"pageProps":{"rule":{"metadata":{"creation_date":"2023/08/23","integration":["endpoint"],"maturity":"production","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0","updated_date":"2023/08/23"},"rule":{"author":["Elastic"],"description":"This rule monitors for common command line flags leveraged by the Chisel server utility followed by a received connection\nwithin a timespan of 1 minute. Chisel is a command-line utility used for creating and managing TCP and UDP tunnels,\nenabling port forwarding and secure communication between machines. Attackers can abuse the Chisel utility to establish\ncovert communication channels, bypass network restrictions, and carry out malicious activities by creating tunnels that\nallow unauthorized access to internal systems.\n","from":"now-9m","index":["logs-endpoint.events.*"],"language":"eql","license":"Elastic License v2","name":"Potential Protocol Tunneling via Chisel Server","references":["https://blog.bitsadmin.com/living-off-the-foreign-land-windows-as-offensive-platform","https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding"],"risk_score":47,"rule_id":"ac8805f6-1e08-406c-962e-3937057fa86f","severity":"medium","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Command and Control","Data Source: Elastic Defend"],"type":"eql","query":"sequence by host.id, process.entity_id with maxspan=1m\n  [process where host.os.type == \"linux\" and event.action == \"exec\" and event.type == \"start\" and \n   process.args == \"server\" and process.args in (\"--port\", \"-p\", \"--reverse\", \"--backend\", \"--socks5\") and \n   process.args_count >= 3 and process.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")]\n  [network where host.os.type == \"linux\" and event.action == \"connection_accepted\" and event.type == \"start\" and \n   destination.ip != null and destination.ip != \"127.0.0.1\" and destination.ip != \"::1\" and \n   not process.name : (\n     \"python*\", \"php*\", \"perl\", \"ruby\", \"lua*\", \"openssl\", \"nc\", \"netcat\", \"ncat\", \"telnet\", \"awk\", \"java\", \"telnet\",\n     \"ftp\", \"socat\", \"curl\", \"wget\", \"dpkg\", \"docker\", \"dockerd\", \"yum\", \"apt\", \"rpm\", \"dnf\", \"ssh\", \"sshd\", \"hugo\")]\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1572","name":"Protocol Tunneling","reference":"https://attack.mitre.org/techniques/T1572/"}],"tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"}}]}}},"__N_SSG":true}