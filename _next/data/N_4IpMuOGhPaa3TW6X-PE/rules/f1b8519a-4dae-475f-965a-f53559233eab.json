{"pageProps":{"rule":{"hunt":{"author":"Elastic","description":"This hunt looks for Microsoft Office child processes with low occurrence frequency. This could be a normal rare behavior as well as potential execution via a malicious document. Adversaries may use Microsoft Office applications to execute malicious code, such as macros, scripts, or other payloads.\n","integration":["endpoint","windows","system"],"uuid":"f1b8519a-4dae-475f-965a-f53559233eab","name":"Microsoft Office Child Processes with Low Occurrence Frequency by Unique Agent","language":["ES|QL"],"license":"Elastic License v2","notes":["Certain processes like `WerFault.exe`, `dw20.exe` and `dwwin.exe` are often related to application crash.","Closer attention should be attributed to lolbins and unsigned executables (Windows 4688 is not capturing process code signature information)."],"mitre":["T1566","T1566.001"],"query":["from logs-endpoint.events.process-*, logs-windows.sysmon_operational-*, logs-system.security-*\n| where host.os.family == \"windows\" and @timestamp > NOW() - 15 day and\n  event.category == \"process\" and event.action in (\"start\", \"Process creation\", \"created-process\") and\n  to_lower(process.parent.name) in (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\") and not starts_with(process.executable, \"C:\\\\Program Files\")\n// normalize user home profile paths\n| eval process_path = replace(to_lower(process.executable), \"\"\"[c]:\\\\[u][s][e][r][s]\\\\[a-zA-Z0-9\\.\\-\\_\\$]+\\\\\"\"\", \"c:\\\\\\\\users\\\\\\\\user\\\\\\\\\")\n| stats occurrences = count(*), agents = count_distinct(agent.id) by process_path, process.parent.name\n| where occurrences == 1 and agents == 1\n"]},"rule":{"tags":["Hunt Type: Hunt"],"query":["from logs-endpoint.events.process-*, logs-windows.sysmon_operational-*, logs-system.security-*\n| where host.os.family == \"windows\" and @timestamp > NOW() - 15 day and\n  event.category == \"process\" and event.action in (\"start\", \"Process creation\", \"created-process\") and\n  to_lower(process.parent.name) in (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\") and not starts_with(process.executable, \"C:\\\\Program Files\")\n// normalize user home profile paths\n| eval process_path = replace(to_lower(process.executable), \"\"\"[c]:\\\\[u][s][e][r][s]\\\\[a-zA-Z0-9\\.\\-\\_\\$]+\\\\\"\"\", \"c:\\\\\\\\users\\\\\\\\user\\\\\\\\\")\n| stats occurrences = count(*), agents = count_distinct(agent.id) by process_path, process.parent.name\n| where occurrences == 1 and agents == 1\n"],"license":"Elastic License v2","description":"This hunt looks for Microsoft Office child processes with low occurrence frequency. This could be a normal rare behavior as well as potential execution via a malicious document. Adversaries may use Microsoft Office applications to execute malicious code, such as macros, scripts, or other payloads.\n","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"","name":"","reference":""},"technique":[{"id":"T1566","name":"","reference":"https://attack.mitre.org/techniques/T1566/"},{"id":"T1566","name":"","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.001","reference":"https://attack.mitre.org/techniques/T1566/001/"}]}]}]},"metadata":{"creation_date":"1970-01-01T00:00:00.000Z","updated_date":"1970-01-01T00:00:00.000Z","integration":["endpoint","windows","system"]}}},"__N_SSG":true}