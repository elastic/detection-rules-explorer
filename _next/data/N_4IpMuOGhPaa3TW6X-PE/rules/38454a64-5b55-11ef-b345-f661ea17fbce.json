{"pageProps":{"rule":{"hunt":{"author":"Elastic","description":"An attacker with compromised EC2 instance credentials, may use those credentials to attempt remote code execution against the EC2 instance from which the credentials were compromised via SSM SendCommand API.\n","integration":["aws.cloudtrail"],"uuid":"38454a64-5b55-11ef-b345-f661ea17fbce","name":"SSM SendCommand API Used by EC2 Instance","language":["ES|QL"],"license":"Elastic License v2","notes":["The indicator that this is an EC2 instance assuming a role and performing the action, is the use of the instance id beginning with -i as the session name.","Session name is attached to the end of the `user.id` field and the `aws.cloudtrail.user_identity.arn`."],"mitre":["T1651"],"query":["from logs-aws.cloudtrail-*\n| where @timestamp > now() - 7 day\n| where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"ssm.amazonaws.com\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n    and event.action == \"SendCommand\"\n    and user.id like \"*:i-*\"\n| keep @timestamp, event.provider, event.action, aws.cloudtrail.user_identity.type, user.id, aws.cloudtrail.request_parameters\n"]},"rule":{"tags":["Hunt Type: Hunt"],"query":["from logs-aws.cloudtrail-*\n| where @timestamp > now() - 7 day\n| where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"ssm.amazonaws.com\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n    and event.action == \"SendCommand\"\n    and user.id like \"*:i-*\"\n| keep @timestamp, event.provider, event.action, aws.cloudtrail.user_identity.type, user.id, aws.cloudtrail.request_parameters\n"],"license":"Elastic License v2","description":"An attacker with compromised EC2 instance credentials, may use those credentials to attempt remote code execution against the EC2 instance from which the credentials were compromised via SSM SendCommand API.\n","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"","name":"","reference":""},"technique":[{"id":"T1651","name":"","reference":"https://attack.mitre.org/techniques/T1651/"}]}]},"metadata":{"creation_date":"1970-01-01T00:00:00.000Z","updated_date":"1970-01-01T00:00:00.000Z","integration":["aws.cloudtrail"]}}},"__N_SSG":true}