{"pageProps":{"rule":{"metadata":{"creation_date":"2025/01/15","integration":["aws"],"maturity":"production","updated_date":"2025/01/15"},"rule":{"author":["Elastic"],"description":"Identifies a high-volume of AWS S3 objects stored in a bucket using using Server-Side Encryption with Customer-Provided Keys\n(SSE-C). Adversaries with compromised AWS credentials can encrypt objects in an S3 bucket using their own encryption\nkeys, rendering the objects unreadable or recoverable without the key. This can be used as a form of ransomware to\nextort the bucket owner for the decryption key. This is a [Threshold](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-threshold-rule) rule that flags when\nthis behavior is observed for a specific bucket more than 15 times in a short time-window.\n","false_positives":["    Legitimate use of Server-Side Encryption with Customer-Provided Keys (SSE-C) to encrypt objects in an S3 bucket.\n    "],"from":"now-9m","index":["filebeat-*","logs-aws.cloudtrail-*"],"language":"kuery","license":"Elastic License v2","name":"Excessive AWS S3 Object Encryption with SSE-C","note":"### Triage and Analysis\n\n#### Investigating Excessive AWS S3 Object Encryption with SSE-C\nThis rule identifies a high volume of objects being encrypted using Server-Side Encryption with Customer-Provided Keys (SSE-C) in AWS S3. This could indicate malicious activity, such as ransomware encrypting objects, rendering them inaccessible without the corresponding encryption keys.\n\n##### Possible Investigation Steps\n\n1. **Identify the User and Source**:\n   - Review the `aws.cloudtrail.user_identity.arn` to identify the IAM user or role performing the operation.\n   - Cross-check the `source.ip` and `user_agent.original` fields for unusual IPs or user agents that could indicate unauthorized access.\n   - Review the `aws.cloudtrail.user_identity.access_key_id` to identify the access key used. This could be a compromised key.\n\n2. **Examine the Targeted Resources**:\n   - Check `aws.cloudtrail.flattened.request_parameters.bucketName` to identify the bucket involved.\n   - Analyze the object key from `aws.cloudtrail.flattened.request_parameters.key`.\n\n3. **Evaluate Encryption Behavior**:\n   - Confirm the encryption details in `aws.cloudtrail.flattened.request_parameters.x-amz-server-side-encryption-customer-algorithm` and `aws.cloudtrail.flattened.additional_eventdata.SSEApplied`.\n   - Note if `SSEApplied` is `SSE-C`, which confirms encryption using a customer-provided key.\n\n4. **Correlate with Recent Events**:\n   - Look for any suspicious activity in proximity to the encryption event, such as new access key creation, policy changes, or unusual access patterns from the same user or IP.\n   - Identify `ListBucket` or `GetObject` operations on the same bucket to determine all affected objects.\n   - For `PutObject` events, identify any other unusual objecs uploaded such as a ransom note.\n\n5. **Validate Access Permissions**:\n   - Check the IAM policies and roles associated with the user to verify if they had legitimate access to encrypt objects.\n\n6. **Assess Impact**:\n   - Identify the number of encrypted objects in the bucket by examining other similar events.\n   - Determine if this encryption aligns with standard business practices or constitutes a deviation.\n\n### False Positive Analysis\n\n- **Legitimate Use Cases**:\n  - Confirm if SSE-C encryption is part of regular operations for compliance or data protection.\n  - Cross-reference known processes or users authorized for SSE-C encryption in the affected bucket.\n\n### Response and Remediation\n\n1. **Immediate Actions**:\n   - Disable access keys or permissions for the user if unauthorized behavior is confirmed.\n   - Rotate the bucket's encryption configuration to mitigate further misuse.\n\n2. **Data Recovery**:\n   - Attempt to identify and contact the party holding the SSE-C encryption keys if recovery is necessary.\n\n3. **Enhance Monitoring**:\n   - Enable alerts for future SSE-C encryption attempts in critical buckets.\n   - Review and tighten IAM policies for roles and users accessing S3.\n\n4. **Post-Incident Review**:\n   - Audit logs for additional activities by the same user or IP.\n   - Document findings and apply lessons learned to improve preventive measures.\n","references":["https://www.halcyon.ai/blog/abusing-aws-native-services-ransomware-encrypting-s3-buckets-with-sse-c","https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerSideEncryptionCustomerKeys.html"],"risk_score":73,"rule_id":"909bf7c8-d371-11ef-bcc3-f661ea17fbcd","setup":"AWS S3 data event types need to be enabled in the CloudTrail trail configuration.","severity":"high","tags":["Domain: Cloud","Data Source: AWS","Data Source: Amazon Web Services","Data Source: AWS S3","Resources: Investigation Guide","Use Case: Threat Detection","Tactic: Impact","Language: kuery"],"timestamp_override":"event.ingested","type":"threshold","query":"event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"s3.amazonaws.com\"\n    and event.action: \"PutObject\"\n    and event.outcome: \"success\"\n    and aws.cloudtrail.flattened.request_parameters.x-amz-server-side-encryption-customer-algorithm: \"AES256\"\n    and aws.cloudtrail.flattened.additional_eventdata.SSEApplied: \"SSE_C\"\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1486","name":"Data Encrypted for Impact","reference":"https://attack.mitre.org/techniques/T1486/"}],"tactic":{"id":"TA0040","name":"Impact","reference":"https://attack.mitre.org/tactics/TA0040/"}}],"threshold":{"field":["aws.cloudtrail.flattened.request_parameters.bucketName"],"value":20}}}},"__N_SSG":true}