{"pageProps":{"rule":{"metadata":{"creation_date":"2023/01/13","integration":["endpoint","windows"],"maturity":"production","updated_date":"2023/12/21","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0"},"rule":{"author":["Elastic"],"description":"Detects Linux Bash commands from the the Windows Subsystem for Linux. Adversaries may enable \nand use WSL for Linux to avoid detection.\n","from":"now-9m","index":["winlogbeat-*","logs-endpoint.events.*","logs-windows.*","endgame-*"],"language":"eql","license":"Elastic License v2","name":"Suspicious Execution via Windows Subsystem for Linux","references":["https://blog.f-secure.com/hunting-for-windows-subsystem-for-linux/","https://lolbas-project.github.io/lolbas/OtherMSBinaries/Wsl/","https://blog.qualys.com/vulnerabilities-threat-research/2022/03/22/implications-of-windows-subsystem-for-linux-for-adversaries-defenders-part-1"],"risk_score":21,"rule_id":"3e0eeb75-16e8-4f2f-9826-62461ca128b7","severity":"low","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Execution","Tactic: Defense Evasion","Data Source: Elastic Endgame","Data Source: Elastic Defend"],"timestamp_override":"event.ingested","type":"eql","query":"process where host.os.type == \"windows\" and event.type : \"start\" and\n  (\n    (\n      (process.executable : \"?:\\\\Windows\\\\System32\\\\bash.exe\" or process.pe.original_file_name == \"Bash.exe\") and \n      not process.command_line : (\"bash\", \"bash.exe\")\n    ) or \n    process.executable : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Packages\\\\*\\\\rootfs\\\\usr\\\\bin\\\\bash\" or \n    (\n      process.parent.name : \"wsl.exe\" and process.parent.command_line : \"bash*\" and not process.name : \"wslhost.exe\"\n    ) or \n    (\n      process.name : \"wsl.exe\" and process.args : (\n        \"curl\", \"/etc/shadow\", \"/etc/passwd\", \"cat\", \"--system\", \"root\", \"-e\", \"--exec\", \"bash\", \"/mnt/c/*\"\n      ) and not process.args : (\"wsl-bootstrap\", \"docker-desktop-data\", \"*.vscode-server*\")\n    )\n  ) and \n    not process.parent.executable : (\"?:\\\\Program Files\\\\Docker\\\\*.exe\", \"?:\\\\Program Files (x86)\\\\Docker\\\\*.exe\")\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1202","name":"Indirect Command Execution","reference":"https://attack.mitre.org/techniques/T1202/"}],"tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"}},{"framework":"MITRE ATT&CK","technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.004","name":"Unix Shell","reference":"https://attack.mitre.org/techniques/T1059/004/"}]}],"tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"}}]}}},"__N_SSG":true}