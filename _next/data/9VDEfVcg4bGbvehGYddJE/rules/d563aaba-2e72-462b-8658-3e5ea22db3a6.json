{"pageProps":{"rule":{"metadata":{"creation_date":"2020/11/26","integration":["endpoint"],"maturity":"production","updated_date":"2024/05/21"},"rule":{"author":["Elastic"],"description":"Identifies a privilege escalation attempt via a rogue Windows directory (Windir) environment variable. This is a known\nprimitive that is often combined with other vulnerabilities to elevate privileges.\n","from":"now-9m","index":["logs-endpoint.events.registry-*","endgame-*","logs-windows.sysmon_operational-*"],"language":"eql","license":"Elastic License v2","name":"Privilege Escalation via Windir Environment Variable","references":["https://www.tiraniddo.dev/2017/05/exploiting-environment-variables-in.html"],"risk_score":73,"rule_id":"d563aaba-2e72-462b-8658-3e5ea22db3a6","severity":"high","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Privilege Escalation","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Sysmon"],"timestamp_override":"event.ingested","type":"eql","query":"registry where host.os.type == \"windows\" and registry.path : (\n    \"HKEY_USERS\\\\*\\\\Environment\\\\windir\",\n    \"HKEY_USERS\\\\*\\\\Environment\\\\systemroot\",\n    \"HKU\\\\*\\\\Environment\\\\windir\",\n    \"HKU\\\\*\\\\Environment\\\\systemroot\",\n    \"\\\\REGISTRY\\\\USER\\\\*\\\\Environment\\\\windir\",\n    \"\\\\REGISTRY\\\\USER\\\\*\\\\Environment\\\\systemroot\"\n    ) and\n not registry.data.strings : (\"C:\\\\windows\", \"%SystemRoot%\")\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1574","name":"Hijack Execution Flow","reference":"https://attack.mitre.org/techniques/T1574/","subtechnique":[{"id":"T1574.007","name":"Path Interception by PATH Environment Variable","reference":"https://attack.mitre.org/techniques/T1574/007/"}]}],"tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"}}]}}},"__N_SSG":true}