{"pageProps":{"rule":{"metadata":{"creation_date":"2021/11/27","integration":["windows"],"maturity":"production","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0","updated_date":"2024/03/08"},"rule":{"author":["Elastic"],"description":"Identifies the creation of an LSASS process clone via PssCaptureSnapShot where the parent process is the initial LSASS\nprocess instance. This may indicate an attempt to evade detection and dump LSASS memory for credential access.\n","from":"now-9m","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"language":"eql","license":"Elastic License v2","name":"Potential LSASS Clone Creation via PssCaptureSnapShot","references":["https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/","https://medium.com/@Achilles8284/the-birth-of-a-process-part-2-97c6fb9c42a2"],"risk_score":73,"rule_id":"a16612dd-b30e-4d41-86a0-ebe70974ec00","setup":"## Setup\n\nThis is meant to run only on datasources using Windows security event 4688 that captures the process clone creation.\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2,\nevents will not define `event.ingested` and default fallback for EQL rules was not added until version 8.2.\nHence for this rule to work effectively, users will need to add a custom ingest pipeline to populate\n`event.ingested` to @timestamp.\nFor more details on adding a custom ingest pipeline refer - https://www.elastic.co/guide/en/fleet/current/data-streams-pipeline-tutorial.html\n","severity":"high","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Credential Access","Data Source: Sysmon"],"timestamp_override":"event.ingested","type":"eql","query":"process where host.os.type == \"windows\" and event.code:\"4688\" and\n  process.executable : \"?:\\\\Windows\\\\System32\\\\lsass.exe\" and\n  process.parent.executable : \"?:\\\\Windows\\\\System32\\\\lsass.exe\"\n","threat":[{"framework":"MITRE ATT&CK","technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}],"tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"}}]}}},"__N_SSG":true}