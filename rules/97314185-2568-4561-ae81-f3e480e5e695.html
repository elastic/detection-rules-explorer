<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Home</title><meta name="next-head-count" content="3"/><meta name="description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:title" content="Elastic Detection Rules"/><meta property="og:description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:url" content="https://github.com/elastic/detection-rules"/><link rel="stylesheet" href="/detection-rules-explorer/themes/eui_theme_dark.45c087c0a7ccec8a2229.min.css" data-name="eui-theme" data-theme-name="Dark" data-theme="dark" disabled="" aria-disabled="true"/><link rel="stylesheet" href="/detection-rules-explorer/themes/eui_theme_light.3de9904404a3ccaf0ed2.min.css" data-name="eui-theme" data-theme-name="Light" data-theme="light"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-16x16.png" sizes="16x16"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-96x96.png" sizes="96x96"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/detection-rules-explorer/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/detection-rules-explorer/_next/static/chunks/webpack-d444f824b18ba952.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/main-4be6f7e434f4c65e.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/pages/_app-f608ed562a5d9c84.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/4218-ffcd6b15488cdf6f.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/8738-e43f3c136aaac828.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/1304-34d1d6ab0f19548d.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/pages/rules/%5Bid%5D-4ed28d85cbc13b0b.js" defer=""></script><script src="/detection-rules-explorer/_next/static/38GctHxztBxzQ7WABo9eD/_buildManifest.js" defer=""></script><script src="/detection-rules-explorer/_next/static/38GctHxztBxzQ7WABo9eD/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next" data-reactroot=""><style data-emotion="css-global 2hgghz">#__next,.guideBody{min-height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="euiHeader euiHeader--default euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a href="/detection-rules-explorer" class="eui-jxpcya"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-7yvbl4-euiIcon-l" role="img" aria-hidden="true"></svg><span class="euiTitle eui-z21xof-euiTitle-xxs">Elastic Security Detection Rules</span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><button class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" type="button" aria-label="Change theme"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-4394ro-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></button></span></div><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><a class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" href="https://github.com/elastic/detection-rules" rel="noreferrer" aria-label="EUI GitHub repo"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-2txxin-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></a></span></div></div></div><div class="eui-gok634"><div class="eui-1kqz3nm"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Microsoft 365 Exchange Anti-Phish Rule Modification</h1><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Last updated <!-- -->10 days ago<!-- --> on<!-- --> <!-- -->2025-01-15</div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Created <!-- -->4 years ago<!-- --> on<!-- --> <!-- -->2020-11-19</div></div></div></div><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">About</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><div class="euiText eui-1yivsv3-euiText-m">Identifies the modification of an anti-phishing rule in Microsoft 365. By default, Microsoft 365 includes built-in
features that help protect users from phishing attacks. Anti-phishing rules increase this protection by refining
settings to better detect and prevent attacks.
</div><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Tags</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#ee789d;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Domain: Cloud</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#D3DAE6;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Data Source: Microsoft 365</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#79aad9;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Use Case: Configuration Audit</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#f1d86f;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Tactic: Initial Access</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#D3DAE6;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Language: kuery</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Severity</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><div class="euiHealth eui-qn8ayk-euiHealth-s"><div class="euiFlexGroup euiFlexGroup--gutterExtraSmall euiFlexGroup--alignItemsCenter euiFlexGroup--directionRow"><div class="euiFlexItem euiFlexItem--flexGrowZero"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1n3oddc-euiIcon-m-warning" role="img" aria-hidden="true"></svg></div><div class="euiFlexItem euiFlexItem--flexGrowZero">medium</div></div></div></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Risk Score</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">47</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">MITRE ATT&amp;CKâ„¢</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/tactics/TA0001/" target="_blank" rel="noopener noreferrer">Initial Access<!-- --> (<!-- -->TA0001<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a><div class="euiText eui-14lwe4a-euiText-xs"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/techniques/T1566/" target="_blank" rel="noopener noreferrer">â†³ <!-- -->Phishing<!-- --> (<!-- -->T1566<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></div><div class="euiSpacer euiSpacer--xs eui-1wffcmx-euiSpacer-xs"></div></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">False Positive Examples</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">    An anti-phishing rule may be deleted by a system or network administrator. Verify that the configuration change was
    expected. Exceptions can be added to this rule to filter expected behavior.
    </dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">License</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/licensing/elastic-license" target="_blank" rel="noopener">Elastic License v2<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></dd></dl></div></div><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Definition</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Rule Type</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Query (Kibana Query Language)</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Integration Pack</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Prebuilt Security Detection Rules</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Index Patterns</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">filebeat-*</span></span></span><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">logs-o365*</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Related Integrations</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://docs.elastic.co/en/integrations/o365" target="_blank" rel="noopener">o365<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Query</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"></dd></dl><div class="euiSpacer euiSpacer--m eui-jv9za2-euiSpacer-m"></div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingLarge"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePreWrap" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:(&quot;Remove-AntiPhishRule&quot; or &quot;Disable-AntiPhishRule&quot;) and event.outcome:success
</span><span class="euiCodeBlock__line"></span></code></pre></div></div></div></div><div class="euiPanel euiPanel--primary euiPanel--paddingMedium euiCallOut euiCallOut--primary eui-1htmxq-euiPanel-none-m-primary-euiCallOut"><p class="euiTitle euiCallOutHeader__title eui-akxjbi-euiTitle-xs-euiCallOutHeader-primary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-vlvl53-euiIcon-m-inherit-euiCallOut__icon" role="img" aria-hidden="true"></svg>Install detection rules in Elastic Security</p><div class="euiText eui-1hexw8x-euiText-s-euiTextColor-default-euiCallOut__description"><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><p>Detect <!-- -->Microsoft 365 Exchange Anti-Phish Rule Modification<!-- --> in the Elastic Security detection engine by installing this rule into your Elastic Stack.</p><p>To setup this rule, check out the installation guide for<!-- --> <a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/guide/en/security/current/prebuilt-rules-management.html" target="_blank" rel="noopener">Prebuilt Security Detection Rules<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a>.</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"rule":{"metadata":{"creation_date":"2020/11/19","integration":["o365"],"maturity":"production","updated_date":"2025/01/15"},"rule":{"author":["Elastic"],"description":"Identifies the modification of an anti-phishing rule in Microsoft 365. By default, Microsoft 365 includes built-in\nfeatures that help protect users from phishing attacks. Anti-phishing rules increase this protection by refining\nsettings to better detect and prevent attacks.\n","false_positives":["    An anti-phishing rule may be deleted by a system or network administrator. Verify that the configuration change was\n    expected. Exceptions can be added to this rule to filter expected behavior.\n    "],"from":"now-30m","index":["filebeat-*","logs-o365*"],"language":"kuery","license":"Elastic License v2","name":"Microsoft 365 Exchange Anti-Phish Rule Modification","note":"## Triage and analysis\n\n\u003e **Disclaimer**:\n\u003e This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Microsoft 365 Exchange Anti-Phish Rule Modification\n\nMicrosoft 365's anti-phishing rules are crucial for safeguarding users against phishing attacks by enhancing detection and prevention settings. Adversaries may attempt to modify or disable these rules to facilitate phishing campaigns, gaining unauthorized access. The detection rule monitors for successful modifications or disabling of anti-phishing rules, signaling potential malicious activity by tracking specific actions within the Exchange environment.\n\n### Possible investigation steps\n\n- Review the event logs for entries with event.dataset set to o365.audit and event.provider set to Exchange to confirm the context of the alert.\n- Check the event.action field for \"Remove-AntiPhishRule\" or \"Disable-AntiPhishRule\" to identify the specific action taken on the anti-phishing rule.\n- Verify the event.outcome field to ensure the action was successful, indicating a potential security concern.\n- Identify the user or account associated with the modification by examining the relevant user fields in the event log.\n- Investigate the user's recent activity and access patterns to determine if there are any other suspicious actions or anomalies.\n- Assess the impact of the rule modification by reviewing any subsequent phishing attempts or security incidents that may have occurred.\n- Consider reverting the changes to the anti-phishing rule and implementing additional security measures if unauthorized access is confirmed.\n\n### False positive analysis\n\n- Administrative changes: Legitimate administrative tasks may involve modifying or disabling anti-phishing rules for testing or configuration purposes. To manage this, create exceptions for known administrative accounts or scheduled maintenance windows.\n- Security audits: Regular security audits might require temporary adjustments to anti-phishing rules. Document these activities and exclude them from alerts by correlating with audit logs.\n- Third-party integrations: Some third-party security tools may interact with Microsoft 365 settings, triggering rule modifications. Identify these tools and exclude their actions from triggering alerts by using their specific identifiers.\n- Policy updates: Organizational policy changes might necessitate updates to anti-phishing rules. Ensure these changes are documented and exclude them from alerts by associating them with approved change management processes.\n\n### Response and remediation\n\n- Immediately isolate the affected user accounts to prevent further unauthorized access and potential spread of phishing attacks.\n- Revert any unauthorized changes to the anti-phishing rules by restoring them to their previous configurations using backup or documented settings.\n- Conduct a thorough review of recent email logs and user activity to identify any potential phishing emails that may have bypassed the modified rules and take steps to quarantine or delete them.\n- Notify the security team and relevant stakeholders about the incident, providing details of the rule modification and any identified phishing attempts.\n- Escalate the incident to the incident response team for further investigation and to determine if additional systems or data have been compromised.\n- Implement enhanced monitoring and alerting for any further attempts to modify anti-phishing rules, ensuring that similar activities are detected promptly.\n- Review and update access controls and permissions for administrative actions within Microsoft 365 to ensure that only authorized personnel can modify security settings.\n\n## Setup\n\nThe Office 365 Logs Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.","references":["https://docs.microsoft.com/en-us/powershell/module/exchange/remove-antiphishrule?view=exchange-ps","https://docs.microsoft.com/en-us/powershell/module/exchange/disable-antiphishrule?view=exchange-ps"],"risk_score":47,"rule_id":"97314185-2568-4561-ae81-f3e480e5e695","severity":"medium","tags":["Domain: Cloud","Data Source: Microsoft 365","Use Case: Configuration Audit","Tactic: Initial Access","Resources: Investigation Guide","Language: kuery"],"timestamp_override":"event.ingested","type":"query","query":"event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:(\"Remove-AntiPhishRule\" or \"Disable-AntiPhishRule\") and event.outcome:success\n","threat":[{"framework":"MITRE ATT\u0026CK","technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/"}],"tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"}}]}}},"__N_SSG":true},"page":"/rules/[id]","query":{"id":"97314185-2568-4561-ae81-f3e480e5e695"},"buildId":"38GctHxztBxzQ7WABo9eD","assetPrefix":"/detection-rules-explorer","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>