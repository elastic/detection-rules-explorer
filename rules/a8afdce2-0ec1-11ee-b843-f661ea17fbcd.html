<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Home</title><meta name="next-head-count" content="3"/><meta name="description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:title" content="Elastic Detection Rules"/><meta property="og:description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:url" content="https://github.com/elastic/detection-rules"/><link rel="stylesheet" href="/detection-rules-explorer/themes/eui_theme_dark.45c087c0a7ccec8a2229.min.css" data-name="eui-theme" data-theme-name="Dark" data-theme="dark" disabled="" aria-disabled="true"/><link rel="stylesheet" href="/detection-rules-explorer/themes/eui_theme_light.3de9904404a3ccaf0ed2.min.css" data-name="eui-theme" data-theme-name="Light" data-theme="light"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-16x16.png" sizes="16x16"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-96x96.png" sizes="96x96"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/detection-rules-explorer/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/detection-rules-explorer/_next/static/chunks/webpack-d444f824b18ba952.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/main-4be6f7e434f4c65e.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/pages/_app-f608ed562a5d9c84.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/4218-ffcd6b15488cdf6f.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/8738-e43f3c136aaac828.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/1304-34d1d6ab0f19548d.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/pages/rules/%5Bid%5D-0d03d4823d05b977.js" defer=""></script><script src="/detection-rules-explorer/_next/static/mH5eVzlCzVnh_kNXWIkUZ/_buildManifest.js" defer=""></script><script src="/detection-rules-explorer/_next/static/mH5eVzlCzVnh_kNXWIkUZ/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next" data-reactroot=""><style data-emotion="css-global 2hgghz">#__next,.guideBody{min-height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="euiHeader euiHeader--default euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a href="/detection-rules-explorer" class="eui-jxpcya"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-7yvbl4-euiIcon-l" role="img" aria-hidden="true"></svg><span class="euiTitle eui-z21xof-euiTitle-xxs">Elastic Security Detection Rules</span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><button class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" type="button" aria-label="Change theme"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-4394ro-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></button></span></div><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><a class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" href="https://github.com/elastic/detection-rules" rel="noreferrer" aria-label="EUI GitHub repo"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-2txxin-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></a></span></div></div></div><div class="eui-gok634"><div class="eui-1kqz3nm"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Potential Malicious File Downloaded from Google Drive</h1><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Last updated <!-- -->3 months ago<!-- --> on<!-- --> <!-- -->2023-10-16</div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Created <!-- -->6 months ago<!-- --> on<!-- --> <!-- -->2023-06-19</div></div></div></div><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">About</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><div class="euiText eui-1yivsv3-euiText-m">Identifies potential malicious file download and execution from Google Drive. The rule checks for download activity from
Google Drive URL, followed by the creation of files commonly leveraged by or for malware. This could indicate an attempt
to run malicious scripts, executables or payloads.
</div><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Tags</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#ee789d;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Domain: Endpoint</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#6dccb1;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">OS: Linux</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#6dccb1;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">OS: Windows</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#6dccb1;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">OS: macOS</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#79aad9;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Use Case: Threat Detection</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#f1d86f;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Tactic: Command and Control</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Severity</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><div class="euiHealth eui-qn8ayk-euiHealth-s"><div class="euiFlexGroup euiFlexGroup--gutterExtraSmall euiFlexGroup--alignItemsCenter euiFlexGroup--directionRow"><div class="euiFlexItem euiFlexItem--flexGrowZero"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-h17o4q-euiIcon-m-danger" role="img" aria-hidden="true"></svg></div><div class="euiFlexItem euiFlexItem--flexGrowZero">high</div></div></div></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Risk Score</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">73</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">MITRE ATT&amp;CK™</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/tactics/TA0011/" target="_blank" rel="noopener noreferrer">Command and Control<!-- --> (<!-- -->TA0011<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a><div class="euiText eui-14lwe4a-euiText-xs"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/techniques/T1105/" target="_blank" rel="noopener noreferrer">↳ <!-- -->Ingress Tool Transfer<!-- --> (<!-- -->T1105<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></div><div class="euiSpacer euiSpacer--xs eui-1wffcmx-euiSpacer-xs"></div></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">False Positive Examples</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Approved third-party applications that use Google Drive download URLs.<!-- -->Legitimate publicly shared files from Google Drive.</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">License</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/licensing/elastic-license" target="_blank" rel="noopener">Elastic License v2<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></dd></dl></div></div><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Definition</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Rule Type</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Event Correlation Rule</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Integration Pack</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Prebuilt Security Detection Rules</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Index Patterns</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">auditbeat-*</span></span></span><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">logs-endpoint*</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Related Integrations</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://docs.elastic.co/en/integrations/endpoint" target="_blank" rel="noopener">endpoint<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Query</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"></dd></dl><div class="euiSpacer euiSpacer--m eui-jv9za2-euiSpacer-m"></div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingLarge"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePreWrap" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">sequence by host.id, process.entity_id with maxspan=30s
</span><span class="euiCodeBlock__line">[any where
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">    /* Look for processes started or libraries loaded from untrusted or unsigned Windows, Linux or macOS binaries */
</span><span class="euiCodeBlock__line">    (event.action in (&quot;exec&quot;, &quot;fork&quot;, &quot;start&quot;, &quot;load&quot;)) or
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">    /* Look for Google Drive download URL with AV flag skipping */
</span><span class="euiCodeBlock__line">    (process.args : &quot;*drive.google.com*&quot; and process.args : &quot;*export=download*&quot; and process.args : &quot;*confirm=no_antivirus*&quot;)
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">    /* ignore trusted processes */
</span><span class="euiCodeBlock__line">    and not (
</span><span class="euiCodeBlock__line">        process.code_signature.trusted == true and
</span><span class="euiCodeBlock__line">        process.code_signature.subject_name:
</span><span class="euiCodeBlock__line">            (&quot;Mozilla Corporation&quot;,
</span><span class="euiCodeBlock__line">            &quot;Google LLC&quot;,
</span><span class="euiCodeBlock__line">            &quot;Google Inc&quot;,
</span><span class="euiCodeBlock__line">            &quot;Bitdefender SRL&quot;,
</span><span class="euiCodeBlock__line">            &quot;Microsoft Corporation&quot;,
</span><span class="euiCodeBlock__line">            &quot;Netskope, Inc.&quot;,
</span><span class="euiCodeBlock__line">            &quot;Avast Software s.r.o.&quot;,
</span><span class="euiCodeBlock__line">            &quot;Microsoft Windows&quot;,
</span><span class="euiCodeBlock__line">            &quot;AVG Technologies USA, LLC&quot;,
</span><span class="euiCodeBlock__line">            &quot;Symantec Corporation&quot;,
</span><span class="euiCodeBlock__line">            &quot;Trend Micro, Inc.&quot;,
</span><span class="euiCodeBlock__line">            &quot;Palo Alto Networks (Netherlands) B.V.&quot;,
</span><span class="euiCodeBlock__line">            &quot;Docker Inc&quot;))
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">    /* ignore common benign processes */
</span><span class="euiCodeBlock__line">    and not process.executable:
</span><span class="euiCodeBlock__line">        (&quot;/bin/terraform&quot;,
</span><span class="euiCodeBlock__line">        &quot;*/bin/dockerd&quot;,
</span><span class="euiCodeBlock__line">        &quot;/usr/local/bin/docker-init&quot;,
</span><span class="euiCodeBlock__line">        &quot;*/bin/go&quot;,
</span><span class="euiCodeBlock__line">        &quot;?:\\Program Files*\\Mozilla Firefox\firefox.exe&quot;,
</span><span class="euiCodeBlock__line">        &quot;?:\\Program Files*\\Google\\Chrome\\Application\\chrome.exe&quot;)
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">    /* ignore shellscripts + go install from legitimate repository*/
</span><span class="euiCodeBlock__line">    and not (process.executable == &quot;/bin/sh&quot; and process.args : &quot;go install google.golang.org*&quot;)]
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">[network where
</span><span class="euiCodeBlock__line">    /* Look for DNS requests for Google Drive */
</span><span class="euiCodeBlock__line">    (dns.question.name : &quot;drive.google.com&quot; and dns.question.type : &quot;A&quot;) or
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">    /* Look for connection attempts to address that resolves to Google */
</span><span class="euiCodeBlock__line">    (destination.as.organization.name : &quot;GOOGLE&quot; and event.action == &quot;connection_attempted&quot;)]
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">/* Identify the creation of files following Google Drive connection with extensions commonly used for executables or libraries */
</span><span class="euiCodeBlock__line">[file where event.action == &quot;creation&quot; and
</span><span class="euiCodeBlock__line">    file.extension :
</span><span class="euiCodeBlock__line">        (&quot;exe&quot;, &quot;dll&quot;, &quot;scr&quot;, &quot;jar&quot;, &quot;pif&quot;, &quot;app&quot;, &quot;dmg&quot;,
</span><span class="euiCodeBlock__line">        &quot;pkg&quot;, &quot;elf&quot;, &quot;so&quot;, &quot;bin&quot;, &quot;deb&quot;, &quot;rpm&quot;,&quot;sh&quot;,&quot;hta&quot;,&quot;lnk&quot;)]
</span><span class="euiCodeBlock__line"></span></code></pre></div></div></div></div><div class="euiPanel euiPanel--primary euiPanel--paddingMedium euiCallOut euiCallOut--primary eui-1htmxq-euiPanel-none-m-primary-euiCallOut"><p class="euiTitle euiCallOutHeader__title eui-akxjbi-euiTitle-xs-euiCallOutHeader-primary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-vlvl53-euiIcon-m-inherit-euiCallOut__icon" role="img" aria-hidden="true"></svg>Install detection rules in Elastic Security</p><div class="euiText eui-1hexw8x-euiText-s-euiTextColor-default-euiCallOut__description"><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><p>Detect <!-- -->Potential Malicious File Downloaded from Google Drive<!-- --> in the Elastic Security detection engine by installing this rule into your Elastic Stack.</p><p>To setup this rule, check out the installation guide for<!-- --> <a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/guide/en/security/current/prebuilt-rules-management.html" target="_blank" rel="noopener">Prebuilt Security Detection Rules<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a>.</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"rule":{"metadata":{"creation_date":"2023/06/19","integration":["endpoint"],"maturity":"production","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0","updated_date":"2023/10/16"},"rule":{"author":["Elastic"],"description":"Identifies potential malicious file download and execution from Google Drive. The rule checks for download activity from\nGoogle Drive URL, followed by the creation of files commonly leveraged by or for malware. This could indicate an attempt\nto run malicious scripts, executables or payloads.\n","false_positives":["Approved third-party applications that use Google Drive download URLs.","Legitimate publicly shared files from Google Drive."],"from":"now-9m","index":["auditbeat-*","logs-endpoint*"],"language":"eql","license":"Elastic License v2","name":"Potential Malicious File Downloaded from Google Drive","references":["https://intelligence.abnormalsecurity.com/blog/google-drive-matanbuchus-malware"],"risk_score":73,"rule_id":"a8afdce2-0ec1-11ee-b843-f661ea17fbcd","severity":"high","tags":["Domain: Endpoint","OS: Linux","OS: Windows","OS: macOS","Use Case: Threat Detection","Tactic: Command and Control"],"type":"eql","query":"sequence by host.id, process.entity_id with maxspan=30s\n[any where\n\n    /* Look for processes started or libraries loaded from untrusted or unsigned Windows, Linux or macOS binaries */\n    (event.action in (\"exec\", \"fork\", \"start\", \"load\")) or\n\n    /* Look for Google Drive download URL with AV flag skipping */\n    (process.args : \"*drive.google.com*\" and process.args : \"*export=download*\" and process.args : \"*confirm=no_antivirus*\")\n\n    /* ignore trusted processes */\n    and not (\n        process.code_signature.trusted == true and\n        process.code_signature.subject_name:\n            (\"Mozilla Corporation\",\n            \"Google LLC\",\n            \"Google Inc\",\n            \"Bitdefender SRL\",\n            \"Microsoft Corporation\",\n            \"Netskope, Inc.\",\n            \"Avast Software s.r.o.\",\n            \"Microsoft Windows\",\n            \"AVG Technologies USA, LLC\",\n            \"Symantec Corporation\",\n            \"Trend Micro, Inc.\",\n            \"Palo Alto Networks (Netherlands) B.V.\",\n            \"Docker Inc\"))\n\n    /* ignore common benign processes */\n    and not process.executable:\n        (\"/bin/terraform\",\n        \"*/bin/dockerd\",\n        \"/usr/local/bin/docker-init\",\n        \"*/bin/go\",\n        \"?:\\\\Program Files*\\\\Mozilla Firefox\\firefox.exe\",\n        \"?:\\\\Program Files*\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")\n\n    /* ignore shellscripts + go install from legitimate repository*/\n    and not (process.executable == \"/bin/sh\" and process.args : \"go install google.golang.org*\")]\n\n[network where\n    /* Look for DNS requests for Google Drive */\n    (dns.question.name : \"drive.google.com\" and dns.question.type : \"A\") or\n\n    /* Look for connection attempts to address that resolves to Google */\n    (destination.as.organization.name : \"GOOGLE\" and event.action == \"connection_attempted\")]\n\n/* Identify the creation of files following Google Drive connection with extensions commonly used for executables or libraries */\n[file where event.action == \"creation\" and\n    file.extension :\n        (\"exe\", \"dll\", \"scr\", \"jar\", \"pif\", \"app\", \"dmg\",\n        \"pkg\", \"elf\", \"so\", \"bin\", \"deb\", \"rpm\",\"sh\",\"hta\",\"lnk\")]\n","threat":[{"framework":"MITRE ATT\u0026CK","technique":[{"id":"T1105","name":"Ingress Tool Transfer","reference":"https://attack.mitre.org/techniques/T1105/"}],"tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"}}]}}},"__N_SSG":true},"page":"/rules/[id]","query":{"id":"a8afdce2-0ec1-11ee-b843-f661ea17fbcd"},"buildId":"mH5eVzlCzVnh_kNXWIkUZ","assetPrefix":"/detection-rules-explorer","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>