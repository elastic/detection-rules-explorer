<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Home</title><meta name="next-head-count" content="3"/><meta name="description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:title" content="Elastic Detection Rules"/><meta property="og:description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:url" content="https://github.com/elastic/detection-rules"/><link rel="stylesheet" href="/detection-rules-explorer/themes/eui_theme_dark.45c087c0a7ccec8a2229.min.css" data-name="eui-theme" data-theme-name="Dark" data-theme="dark" disabled="" aria-disabled="true"/><link rel="stylesheet" href="/detection-rules-explorer/themes/eui_theme_light.3de9904404a3ccaf0ed2.min.css" data-name="eui-theme" data-theme-name="Light" data-theme="light"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-16x16.png" sizes="16x16"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/detection-rules-explorer/images/favicon/prod/favicon-96x96.png" sizes="96x96"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/detection-rules-explorer/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/detection-rules-explorer/_next/static/chunks/webpack-d444f824b18ba952.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/main-4be6f7e434f4c65e.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/pages/_app-f608ed562a5d9c84.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/4218-ffcd6b15488cdf6f.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/8738-e43f3c136aaac828.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/1304-34d1d6ab0f19548d.js" defer=""></script><script src="/detection-rules-explorer/_next/static/chunks/pages/rules/%5Bid%5D-4ed28d85cbc13b0b.js" defer=""></script><script src="/detection-rules-explorer/_next/static/z12kh8zBhT17LVxcHfIGP/_buildManifest.js" defer=""></script><script src="/detection-rules-explorer/_next/static/z12kh8zBhT17LVxcHfIGP/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next" data-reactroot=""><style data-emotion="css-global 2hgghz">#__next,.guideBody{min-height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="euiHeader euiHeader--default euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a href="/detection-rules-explorer" class="eui-jxpcya"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-7yvbl4-euiIcon-l" role="img" aria-hidden="true"></svg><span class="euiTitle eui-z21xof-euiTitle-xxs">Elastic Security Detection Rules</span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><button class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" type="button" aria-label="Change theme"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-4394ro-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></button></span></div><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><a class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" href="https://github.com/elastic/detection-rules" rel="noreferrer" aria-label="EUI GitHub repo"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-2txxin-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></a></span></div></div></div><div class="eui-gok634"><div class="eui-1kqz3nm"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Polkit Policy Creation</h1><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Last updated <!-- -->a day ago<!-- --> on<!-- --> <!-- -->2025-01-23</div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Created <!-- -->8 days ago<!-- --> on<!-- --> <!-- -->2025-01-16</div></div></div></div><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">About</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><div class="euiText eui-1yivsv3-euiText-m">This rule monitors for the creation of Polkit policy files on Linux systems. Polkit policy files are used to
define the permissions for system-wide services and applications. The creation of new Polkit policy files may
indicate an attempt to modify the authentication process, which could be used for persistence by an adversary.
</div><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Tags</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#ee789d;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Domain: Endpoint</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#6dccb1;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">OS: Linux</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#79aad9;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Use Case: Threat Detection</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#f1d86f;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Tactic: Credential Access</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#f1d86f;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Tactic: Persistence</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#D3DAE6;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Data Source: Elastic Defend</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#D3DAE6;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Data Source: SentinelOne</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#D3DAE6;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Data Source: Elastic Endgame</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#D3DAE6;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Language: eql</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Severity</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><div class="euiHealth eui-qn8ayk-euiHealth-s"><div class="euiFlexGroup euiFlexGroup--gutterExtraSmall euiFlexGroup--alignItemsCenter euiFlexGroup--directionRow"><div class="euiFlexItem euiFlexItem--flexGrowZero"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1b2fr2v-euiIcon-m-subdued" role="img" aria-hidden="true"></svg></div><div class="euiFlexItem euiFlexItem--flexGrowZero">low</div></div></div></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Risk Score</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">21</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">MITRE ATT&amp;CK™</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/tactics/TA0003/" target="_blank" rel="noopener noreferrer">Persistence<!-- --> (<!-- -->TA0003<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a><div class="euiText eui-14lwe4a-euiText-xs"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/techniques/T1543/" target="_blank" rel="noopener noreferrer">↳ <!-- -->Create or Modify System Process<!-- --> (<!-- -->T1543<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></div><div class="euiSpacer euiSpacer--xs eui-1wffcmx-euiSpacer-xs"></div></p><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/tactics/TA0006/" target="_blank" rel="noopener noreferrer">Credential Access<!-- --> (<!-- -->TA0006<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a><div class="euiText eui-14lwe4a-euiText-xs"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/techniques/T1556/" target="_blank" rel="noopener noreferrer">↳ <!-- -->Modify Authentication Process<!-- --> (<!-- -->T1556<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></div><div class="euiSpacer euiSpacer--xs eui-1wffcmx-euiSpacer-xs"></div></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">License</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/licensing/elastic-license" target="_blank" rel="noopener">Elastic License v2<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></dd></dl></div></div><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Definition</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Rule Type</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Event Correlation Rule</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Integration Pack</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Prebuilt Security Detection Rules</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Index Patterns</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">logs-endpoint.events.file*</span></span></span><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">logs-sentinel_one_cloud_funnel.*</span></span></span><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">endgame-*</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Related Integrations</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://docs.elastic.co/en/integrations/endpoint" target="_blank" rel="noopener">endpoint<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://docs.elastic.co/en/integrations/sentinel_one_cloud_funnel" target="_blank" rel="noopener">sentinel_one_cloud_funnel<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Query</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"></dd></dl><div class="euiSpacer euiSpacer--m eui-jv9za2-euiSpacer-m"></div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingLarge"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePreWrap" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">file where host.os.type == &quot;linux&quot; and event.type == &quot;creation&quot; and process.executable != null and
</span><span class="euiCodeBlock__line">file.extension in (&quot;rules&quot;, &quot;pkla&quot;, &quot;policy&quot;) and file.path like~ (
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">  // Rule files
</span><span class="euiCodeBlock__line">  &quot;/etc/polkit-1/rules.d/*&quot;, &quot;/usr/share/polkit-1/rules.d/*&quot;,
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">  // pkla files
</span><span class="euiCodeBlock__line">  &quot;/etc/polkit-1/localauthority/*&quot;, &quot;/var/lib/polkit-1/localauthority/*&quot;,
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">  // Action files
</span><span class="euiCodeBlock__line">  &quot;/usr/share/polkit-1/actions/*&quot;,
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">  // Misc. legacy paths
</span><span class="euiCodeBlock__line">  &quot;/lib/polkit-1/rules.d/*&quot;, &quot;/lib64/polkit-1/rules.d/*&quot;, &quot;/var/lib/polkit-1/rules.d/*&quot;
</span><span class="euiCodeBlock__line">) and not (
</span><span class="euiCodeBlock__line">  process.executable in (
</span><span class="euiCodeBlock__line">    &quot;/bin/dpkg&quot;, &quot;/usr/bin/dpkg&quot;, &quot;/bin/dockerd&quot;, &quot;/usr/bin/dockerd&quot;, &quot;/usr/sbin/dockerd&quot;, &quot;/bin/microdnf&quot;,
</span><span class="euiCodeBlock__line">    &quot;/usr/bin/microdnf&quot;, &quot;/bin/rpm&quot;, &quot;/usr/bin/rpm&quot;, &quot;/bin/snapd&quot;, &quot;/usr/bin/snapd&quot;, &quot;/bin/yum&quot;, &quot;/usr/bin/yum&quot;,
</span><span class="euiCodeBlock__line">    &quot;/bin/dnf&quot;, &quot;/usr/bin/dnf&quot;, &quot;/bin/podman&quot;, &quot;/usr/bin/podman&quot;, &quot;/bin/dnf-automatic&quot;, &quot;/usr/bin/dnf-automatic&quot;,
</span><span class="euiCodeBlock__line">    &quot;/bin/pacman&quot;, &quot;/usr/bin/pacman&quot;, &quot;/usr/bin/dpkg-divert&quot;, &quot;/bin/dpkg-divert&quot;, &quot;/sbin/apk&quot;, &quot;/usr/sbin/apk&quot;,
</span><span class="euiCodeBlock__line">    &quot;/usr/local/sbin/apk&quot;, &quot;/usr/bin/apt&quot;, &quot;/usr/sbin/pacman&quot;, &quot;/bin/podman&quot;, &quot;/usr/bin/podman&quot;, &quot;/usr/bin/puppet&quot;,
</span><span class="euiCodeBlock__line">    &quot;/bin/puppet&quot;, &quot;/opt/puppetlabs/puppet/bin/puppet&quot;, &quot;/usr/bin/chef-client&quot;, &quot;/bin/chef-client&quot;,
</span><span class="euiCodeBlock__line">    &quot;/bin/autossl_check&quot;, &quot;/usr/bin/autossl_check&quot;, &quot;/proc/self/exe&quot;, &quot;/dev/fd/*&quot;,  &quot;/usr/bin/pamac-daemon&quot;,
</span><span class="euiCodeBlock__line">    &quot;/bin/pamac-daemon&quot;, &quot;/usr/lib/snapd/snapd&quot;, &quot;/usr/local/bin/dockerd&quot;, &quot;/usr/bin/crio&quot;, &quot;/usr/sbin/crond&quot;,
</span><span class="euiCodeBlock__line">    &quot;/opt/puppetlabs/puppet/bin/ruby&quot;, &quot;/usr/libexec/platform-python&quot;, &quot;/kaniko/kaniko-executor&quot;,
</span><span class="euiCodeBlock__line">    &quot;/usr/local/bin/dockerd&quot;, &quot;/usr/bin/podman&quot;, &quot;/bin/install&quot;, &quot;/proc/self/exe&quot;, &quot;/usr/lib/systemd/systemd&quot;,
</span><span class="euiCodeBlock__line">    &quot;/usr/sbin/sshd&quot;, &quot;/usr/bin/gitlab-runner&quot;, &quot;/opt/gitlab/embedded/bin/ruby&quot;, &quot;/usr/sbin/gdm&quot;, &quot;/usr/bin/install&quot;,
</span><span class="euiCodeBlock__line">    &quot;/usr/local/manageengine/uems_agent/bin/dcregister&quot;, &quot;/usr/local/bin/pacman&quot;
</span><span class="euiCodeBlock__line">  ) or
</span><span class="euiCodeBlock__line">process.executable like~ (
</span><span class="euiCodeBlock__line">    &quot;/nix/store/*&quot;, &quot;/var/lib/dpkg/*&quot;, &quot;/tmp/vmis.*&quot;, &quot;/snap/*&quot;, &quot;/dev/fd/*&quot;, &quot;/usr/lib/virtualbox/*&quot;
</span><span class="euiCodeBlock__line">  )
</span><span class="euiCodeBlock__line">)
</span><span class="euiCodeBlock__line"></span></code></pre></div></div></div></div><div class="euiPanel euiPanel--primary euiPanel--paddingMedium euiCallOut euiCallOut--primary eui-1htmxq-euiPanel-none-m-primary-euiCallOut"><p class="euiTitle euiCallOutHeader__title eui-akxjbi-euiTitle-xs-euiCallOutHeader-primary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-vlvl53-euiIcon-m-inherit-euiCallOut__icon" role="img" aria-hidden="true"></svg>Install detection rules in Elastic Security</p><div class="euiText eui-1hexw8x-euiText-s-euiTextColor-default-euiCallOut__description"><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><p>Detect <!-- -->Polkit Policy Creation<!-- --> in the Elastic Security detection engine by installing this rule into your Elastic Stack.</p><p>To setup this rule, check out the installation guide for<!-- --> <a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/guide/en/security/current/prebuilt-rules-management.html" target="_blank" rel="noopener">Prebuilt Security Detection Rules<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a>.</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"rule":{"metadata":{"creation_date":"2025/01/16","integration":["endpoint","sentinel_one_cloud_funnel"],"maturity":"production","updated_date":"2025/01/23","min_stack_version":"8.13.0","min_stack_comments":"Breaking change at 8.13.0 for SentinelOne Integration."},"rule":{"author":["Elastic"],"description":"This rule monitors for the creation of Polkit policy files on Linux systems. Polkit policy files are used to\ndefine the permissions for system-wide services and applications. The creation of new Polkit policy files may\nindicate an attempt to modify the authentication process, which could be used for persistence by an adversary.\n","from":"now-9m","index":["logs-endpoint.events.file*","logs-sentinel_one_cloud_funnel.*","endgame-*"],"language":"eql","license":"Elastic License v2","name":"Polkit Policy Creation","risk_score":21,"rule_id":"0f54e947-9ab3-4dff-9e8d-fb42493eaa2f","severity":"low","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Credential Access","Tactic: Persistence","Data Source: Elastic Defend","Data Source: SentinelOne","Data Source: Elastic Endgame","Resources: Investigation Guide","Language: eql"],"timestamp_override":"event.ingested","type":"eql","query":"file where host.os.type == \"linux\" and event.type == \"creation\" and process.executable != null and\nfile.extension in (\"rules\", \"pkla\", \"policy\") and file.path like~ (\n\n  // Rule files\n  \"/etc/polkit-1/rules.d/*\", \"/usr/share/polkit-1/rules.d/*\",\n\n  // pkla files\n  \"/etc/polkit-1/localauthority/*\", \"/var/lib/polkit-1/localauthority/*\",\n\n  // Action files\n  \"/usr/share/polkit-1/actions/*\",\n\n  // Misc. legacy paths\n  \"/lib/polkit-1/rules.d/*\", \"/lib64/polkit-1/rules.d/*\", \"/var/lib/polkit-1/rules.d/*\"\n) and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/bin/crio\", \"/usr/sbin/crond\",\n    \"/opt/puppetlabs/puppet/bin/ruby\", \"/usr/libexec/platform-python\", \"/kaniko/kaniko-executor\",\n    \"/usr/local/bin/dockerd\", \"/usr/bin/podman\", \"/bin/install\", \"/proc/self/exe\", \"/usr/lib/systemd/systemd\",\n    \"/usr/sbin/sshd\", \"/usr/bin/gitlab-runner\", \"/opt/gitlab/embedded/bin/ruby\", \"/usr/sbin/gdm\", \"/usr/bin/install\",\n    \"/usr/local/manageengine/uems_agent/bin/dcregister\", \"/usr/local/bin/pacman\"\n  ) or\nprocess.executable like~ (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/virtualbox/*\"\n  )\n)\n","note":"## Triage and analysis\n\n\u003e **Disclaimer**:\n\u003e This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Polkit Policy Creation\n\nPolkit, or PolicyKit, is a system service in Linux environments that manages system-wide privileges, allowing non-privileged processes to communicate with privileged ones. Adversaries may exploit Polkit by creating or modifying policy files to gain unauthorized access or maintain persistence. The detection rule monitors the creation of these files in critical directories, excluding known legitimate processes, to identify potential malicious activity.\n\n### Possible investigation steps\n\n- Review the file path and extension to confirm if the created file is located in one of the critical directories specified in the query, such as /etc/polkit-1/rules.d/ or /usr/share/polkit-1/actions/.\n- Identify the process executable responsible for the file creation and verify if it is listed in the exclusion list of known legitimate processes. If not, this may warrant further investigation.\n- Check the timestamp of the file creation event to determine if it coincides with any known maintenance or update activities, which could explain the file creation.\n- Investigate the user account associated with the process that created the file to determine if it has the necessary privileges and if the activity aligns with the user's typical behavior.\n- Examine any recent changes or updates to the system that might have triggered the creation of the Polkit policy file, such as software installations or configuration changes.\n- Look for any related alerts or logs that might indicate a broader pattern of suspicious activity, such as unauthorized access attempts or other policy modifications.\n\n### False positive analysis\n\n- System package managers like dpkg, rpm, and yum may create or modify Polkit policy files during legitimate software installations or updates. To handle these, ensure that the rule excludes processes associated with these package managers as specified in the rule's exception list.\n- Container management tools such as Docker and Podman might also trigger false positives when managing containerized applications. Users should verify that these executables are included in the exclusion list to prevent unnecessary alerts.\n- Automation tools like Puppet and Chef can modify policy files as part of their configuration management tasks. Confirm that these processes are part of the exclusion criteria to avoid false positives.\n- Snap package installations and updates can lead to the creation of policy files. Ensure that paths related to Snap are covered in the exclusion patterns to minimize false alerts.\n- Virtualization software such as VirtualBox may interact with Polkit policy files. Users should check that relevant paths and executables are included in the exceptions to reduce false positives.\n\n### Response and remediation\n\n- Isolate the affected system from the network to prevent further unauthorized access or lateral movement by the adversary.\n- Terminate any suspicious processes identified as creating or modifying Polkit policy files, especially those not listed in the known legitimate processes.\n- Review and restore the integrity of the Polkit policy files by comparing them against a known good baseline or backup to ensure no unauthorized changes persist.\n- Conduct a thorough scan of the system using updated antivirus or endpoint detection and response (EDR) tools to identify and remove any additional malicious files or processes.\n- Implement additional monitoring on the affected system and similar systems to detect any further attempts to create or modify Polkit policy files.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if the threat is part of a larger attack campaign.\n- Review and update access controls and permissions related to Polkit policy files to ensure only authorized processes and users can create or modify these files, reducing the risk of future exploitation.","threat":[{"framework":"MITRE ATT\u0026CK","technique":[{"id":"T1543","name":"Create or Modify System Process","reference":"https://attack.mitre.org/techniques/T1543/"}],"tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"}},{"framework":"MITRE ATT\u0026CK","technique":[{"id":"T1556","name":"Modify Authentication Process","reference":"https://attack.mitre.org/techniques/T1556/"}],"tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"}}]}}},"__N_SSG":true},"page":"/rules/[id]","query":{"id":"0f54e947-9ab3-4dff-9e8d-fb42493eaa2f"},"buildId":"z12kh8zBhT17LVxcHfIGP","assetPrefix":"/detection-rules-explorer","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>